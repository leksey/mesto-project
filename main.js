(()=>{"use strict";function e(e){e.classList.add("popup_opened"),window.addEventListener("keydown",n),document.addEventListener("click",o)}function t(e){e.classList.remove("popup_opened"),window.removeEventListener("keydown",n),document.removeEventListener("click",o)}function n(e){"Escape"===e.key&&t(document.querySelector(".popup_opened"))}function o(e){e.target.classList.contains("popup")&&t(e.target)}var r={baseUrl:"https://nomoreparties.co/v1/plus-cohort-10",headers:{authorization:"9604af3d-5a7c-4d72-b14c-31174b7ac9d5","Content-Type":"application/json"}};function c(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var u=document.querySelector("#card-template").content,i=document.querySelector(".popup_pic"),a=i.querySelector(".popup__img"),l=i.querySelector(".popup__capture"),s=document.querySelector(".places");function d(t,n){var o=u.querySelector(".card").cloneNode(!0),s=o.querySelector(".card__picture"),d=o.querySelector(".card__like-counter"),f=o.querySelector(".card__capture"),m=o.querySelector(".card__delete-button"),v=o.querySelector(".card__like-button"),h=t.likes;return s.src=t.link,s.alt=t.name,f.textContent=t.name,_(h,d),p(h,n,v),v.addEventListener("click",(function(e){var o=function(e,t){var n="PUT";return e.forEach((function(e){e._id===t&&(n="DELETE")})),n}(h,n);(function(e,t){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(t),{method:e,headers:r.headers}).then((function(e){return c(e)}))})(o,t._id).then((function(e){_(h=e.likes,d),p(h,n,v)})).catch((function(e){console.log(e)}))})),n===t.owner._id?m.addEventListener("click",(function(e){var n;(n=t._id,fetch("".concat(r.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:r.headers}).then((function(e){return c(e)}))).then((function(){e.target.closest(".card").remove()})).catch((function(e){console.log(e)}))})):m.classList.add("card__delete-button_status_hidden"),s.addEventListener("click",(function(){e(i),a.src=t.link,a.alt=t.name,l.textContent=t.name})),o}function f(e){s.prepend(e)}function _(e,t){t.textContent=e.length}function p(e,t,n){var o=!1;e.some((function(e){e._id===t&&(o=!0)})),o?n.classList.add("card__like-button_status_active"):n.classList.remove("card__like-button_status_active")}var m=function(e,t,n){e.forEach((function(e){})),function(e){return e.some((function(e){return!e.validity.valid}))}(e)?v(t,n.inactiveButtonClass):(t.classList.remove(n.inactiveButtonClass),t.disabled=!1)};function v(e,t){e.classList.add(t),e.disabled=!0}var h=document.querySelector(".profile__edit-button"),y=document.querySelector(".profile__add-button"),S=document.querySelector(".profile__picture-button"),b=document.querySelectorAll(".popup__close-button"),q=document.querySelector(".popup_add"),E=q.querySelector(".form"),L=E.querySelector(".form__submit-button"),k=document.querySelector(".popup_profile"),C=k.querySelector(".form"),g=C.querySelector(".form__submit-button"),x=C.querySelector(".form__input-text_field_name"),U=C.querySelector(".form__input-text_field_caption"),B=document.querySelector(".profile__name"),w=document.querySelector(".profile__caption"),A=document.querySelector(".profile__picture"),T=E.querySelector(".form__input-text_field_caption"),D=E.querySelector(".form__input-text_field_link"),P=document.querySelector(".popup_profile-picture"),N=P.querySelector(".form"),O=N.querySelector(".form__submit-button"),j=N.querySelector(".form__input-text_field_link"),J={},H={formSelector:".form",inputSelector:".form__input-text",submitButtonSelector:".form__submit-button",inactiveButtonClass:"form__submit-button_status_inactive",inputErrorClass:"form__input-text_status_error"};function z(e){B.textContent=e.name,w.textContent=e.about,A.src=e.avatar}function M(e){J.name=e.name,J.about=e.about,J.avatar=e.avatar,J.id=e._id}function F(e,t){e.value=t}h.addEventListener("click",(function(){e(k),x.value=J.name,U.value=J.about})),y.addEventListener("click",(function(){e(q)})),S.addEventListener("click",(function(){e(P)})),b.forEach((function(e){var n=e.closest(".popup");e.addEventListener("click",(function(){return t(n)}))})),C.addEventListener("submit",(function(e){var n,o;F(g,"Сохранение..."),e.preventDefault(),(n=x.value,o=U.value,fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:n,about:o})}).then((function(e){return c(e)}))).then((function(e){M(e),z(e),t(k),v(g,H.inactiveButtonClass)})).catch((function(e){console.log(e)})).finally((function(){F(g,"Сохраненить")}))})),E.addEventListener("submit",(function(e){var n,o;F(L,"Сохранение..."),e.preventDefault(),(n=T.value,o=D.value,fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:n,link:o})}).then((function(e){return c(e)}))).then((function(e){f(d(e,J.id)),t(q),E.reset(),v(L,H.inactiveButtonClass)})).catch((function(e){console.log(e)})).finally((function(){F(L,"Сохраненить")}))})),N.addEventListener("submit",(function(e){var n;F(O,"Сохранение..."),e.preventDefault(),(n=j.value,fetch("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:n})}).then((function(e){return c(e)}))).then((function(e){M(e),z(e),t(P),v(O,H.inactiveButtonClass)})).catch((function(e){console.log(e)})).finally((function(){F(O,"Сохраненить")}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);m(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-input-error"));t.classList.remove(n.inputErrorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-input-error"));t.classList.add(o.inputErrorClass),r.textContent=n}(e,t,t.validationMessage,n)}(e,r,t),m(n,o,t)}))}))}(t,e)}))}(H),fetch("".concat(r.baseUrl,"/users/me"),{headers:r.headers}).then((function(e){return c(e)})).then((function(e){M(e),z(J),fetch("".concat(r.baseUrl,"/cards"),{headers:r.headers}).then((function(e){return c(e)})).then((function(e){e.reverse().forEach((function(e){return f(d(e,J.id))}))})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))})();